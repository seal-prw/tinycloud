<h1>Raspberry Pi 3 cluster with flashing light boards using Docker Swarm</h1>

In this demo I have implemented 2-node raspberry pi cluster using docker swarm. The raspberry pi devices are already quipped with Pimoroni Blinkt Eight super-bright RGB LED indicators chip. This demo simulates the docker swarm cluster where same software docker image is deployed on multiple containers distributed across multiple nodes. To run this demo use following commands and the output of the program is explained later:

Initialize Docker Swarm:

docker swarm init

Join other nodes with below autogenerated token:

docker swarm join --token SWMTKN-1-5p2k533alt4jmyo53ui1wey4eyshfaapsb7zmgqq00lxfump43-9i8a0gytd3kc5wil5zyih84qw 10.100.31.178:2377 
(Note: Above is the sample token every docker swarm init command will generate new token)

Create network bridge for the application:

docker network create --driver overlay --attachable swarm_blinkt_bridge

Create a docker swarm service:

<b>docker service create --name swarm_blinkt --publish published=5000,target=5000 --env CONTAINER_NUMBER="{{.Task.Slot}}" --replicas 8 --network name=swarm_blinkt_bridge,alias=search --no-resolve-image --mount type=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock prasannawarunkar/swarm_flask_blinkt_red:latest python webblinkt.py</b>	
	
To test the application:

Open host browser and enter http://localhost:5000 or curl -s http://localhost:5000


![](BlinktSwarm.gif)


The http request is redirected to random node on random container by Docker Swarm manager. 

To update software image on all nodes on all containers use:

docker service update --no-resolve-image --image prasannawarunkar/swarm_flask_blinkt_green:latest swarm_blinkt

This will update the image on all the containers and green lights will start blinking. 

